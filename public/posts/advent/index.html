<!DOCTYPE html>
<html>
  <head>
    <title>Automated Advent of Code repo badges</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/assets/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/assets/css/layouts/main.css"/>
<link rel="stylesheet" href="/assets/css/style.css"/>
<link rel="stylesheet" href="/assets/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon.ico" />


<link rel="stylesheet" href="/assets/css/style.css"/>

    
<meta name="description" content="Created a repo badge that scrapes your Advent of Code Star count" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/assets/css/layouts/single.css"/>
<link rel="stylesheet" href="/assets/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    




<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/assets/images/main-logo.png">William Bonnell</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="images/site/favicon.ico" class="d-none" id="main-logo">
  <img src="images/site/favicon.ico" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/advent/">Automated Advent of Code repo badges</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tooltips/">Custom datatable Tooltips in Shiny</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/hypothetical_outcome_plots/">Hypothetical Outcome Plots</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(http://willdebras.github.io/images/blog/starcount.png);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/profile.jpg'/>
          <h5 class="author-name">Will Bonnell</h5>
          <p>December 10, 2020</p>
        </div>

        <div class="title">
          <h1>Automated Advent of Code repo badges</h1>
        </div>

        <div class="post-content" id="post-content">
          
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<div id="advent-of-code" class="section level2">
<h2>Advent of Code</h2>
<p>The Advent of Code is an annual Advent calendar of short language-agnostic programming puzzles. This year I have been using the Advent of Code to test my knowledge of programming principles, work on algorithmic efficiency, and practice working in new (to me) languages like Julia. Since I am including my work publicly on github, I also thought it would be interesting to try to create an automated repo badge to show off how many stars I have accumulated. This post is about how I created this badge and how you could include an automatically updating repo badge to show off your star count this advent season.</p>
<p>If you have logged into <a href="adventofcode.com">adventofcode.com</a>, you will know there is a small div to display your username and the number of stars you have accumulated through the challenges.</p>
<p><img src="/images/blog/adventtop.png" /></p>
<p>To get this into a repo badge, the process will require two main tasks:</p>
<ol style="list-style-type: decimal">
<li>Scraping the star count from adventofcode.com with session info</li>
<li>Creating the repo badge with the information</li>
</ol>
</div>
<div id="scraping-the-star-count" class="section level2">
<h2>Scraping the star count</h2>
<p>In order to scrape the star count, we will need to use session information to authenticate to the website. If we do not have session info, the div with an individual’s stars would not exist on the main advent of code page. We use code from Benjamin Guinaudeau’s <code>{adventr}</code> package to scrape this information. First, we log in to <a href="adventofcode.com">adventofcode.com</a> to generate a session cookie and then grab that cookie from Chrome’s developer tools that we can pass to a function to scrape the star count. Benjamin Guinaudea’s walkthrough on the <a href="https://github.com/benjaminguinaudeau/adventr">{adventr} package</a> explains this step in detail.</p>
<p>Then we can use code from adventr to pass a <code>GET</code> to our webpage with the session argument equal to the session cookie that pull from developer tools:</p>
<pre class="r"><code>  req &lt;- httr::GET(glue::glue(&#39;https://adventofcode.com/&#39;),
                   httr::add_headers(.headers = c(
                     &quot;user-agent&quot; = &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) 
                                     AppleWebKit/537.36 (KHTML, like Gecko) 
                                     Chrome/86.0.4240.198 Safari/537.36&quot;,
                     &quot;cookie&quot; = paste0(&quot;session=&quot;, cookie)
                   )))</code></pre>
<p>This will return the raw webpage as if we were logged into the page. This will allow us to access the star count.</p>
<p>The scraping of the star count itself then it just isolating an XPath or CSS classes that correspond with the div or node we care about. We can use Chrome or Firefox developer tools, but I like to use the <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb">SelectorGadget Chrome extension</a> to find appropriate CSS or HTML tags.</p>
<p><img src="/images/blog/gadget.png" /></p>
<p>The last section of the code will need to do a few things:</p>
<ol style="list-style-type: decimal">
<li>Parse the raw HTML from our <code>GET</code> call with <code>xml2::read_html()</code>.</li>
<li>Extract the node we found from SelectorGadget with <code>rvest::html_node()</code>.</li>
<li>Extract text from that node with <code>rvest::html_text()</code>.</li>
</ol>
<pre class="r"><code>  parsed &lt;- xml2::read_html(req)
  
  stars &lt;- rvest::html_node(parsed, &quot;.user&quot;)
  
  star_text &lt;- rvest::html_text(stars)</code></pre>
<p>This code will return the div with the class <code>.user</code>, which is our username and the star count:</p>
<pre class="r"><code>willdebras 10*</code></pre>
</div>
<div id="creating-a-repo-badge" class="section level2">
<h2>Creating a repo badge</h2>
<p>The next step is just creating a repo badge. We can pull a custom SVG badge to include in a <code>.md</code> file from <a href="https://shields.io/">shields.io</a>. We can pass a custom URL to generate a badge:</p>
<p><img src="/images/blog/badgenotfound.png" /></p>
<p>In our use case, we just pass the words “star count” and the text we scraped above, as well as a parameter for color:</p>
<pre class="r"><code>  badge &lt;- paste0(&quot;![](https://img.shields.io/badge/&quot;, 
                  &quot;star count&quot;, 
                  &quot;-&quot;, 
                  star_text, 
                  &quot;-&quot;, 
                  color, 
                  &quot;.svg)&quot;)</code></pre>
<p>All together, we can functionalize this and call the function in our <code>.rmd README</code>.</p>
<p>The full function that takes our cookies as an environment variable, reads and parses the webpage, and generates a badge looks like this:</p>
<pre class="r"><code>badge_stars &lt;- function(color = &quot;green&quot;, url = NULL, cookie = Sys.getenv(&quot;ADVENT_COOKIE&quot;)) {
  
  req &lt;- httr::GET(glue::glue(&#39;https://adventofcode.com/&#39;),
                   httr::add_headers(.headers = c(
                     &quot;user-agent&quot; = &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) 
                     AppleWebKit/537.36 (KHTML, like Gecko) 
                     Chrome/86.0.4240.198 Safari/537.36&quot;,
                     &quot;cookie&quot; = paste0(&quot;session=&quot;, cookie)
                   )))
  
  
  #parsed &lt;- httr::content(req, as = &quot;text&quot;)
  
  parsed &lt;- xml2::read_html(req)
  
  stars &lt;- rvest::html_node(parsed, &quot;.user&quot;)
  
  star_text &lt;- rvest::html_text(stars)
  
  
  
  badge &lt;- paste0(&quot;![](https://img.shields.io/badge/&quot;, &quot;star count&quot;, &quot;-&quot;, star_text, &quot;-&quot;, color, &quot;.svg)&quot;)
  
  if (is.null(url))
    return(badge)
  
  paste0(&quot;[&quot;, badge, &quot;](&quot;, url, &quot;)&quot;)
}</code></pre>
<p>In our <code>README</code>, we can call our function in a code chunk to include our badge on a repo:</p>
<pre class="r"><code>badge_stars(color = &quot;yellow&quot;)</code></pre>
<p><img src="/images/blog/star2.png" /></p>
</div>

        </div>

        
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  
    
    
      
        
        
        <div class="col-md-12 next-article">
          <a href="/posts/tooltips/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>Custom datatable Tooltips in Shiny</span>
          </a>
        </div>
      
    
  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
  </section>

    </div>

    

  




  




  
  
    
  


<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experiences</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
            
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>wbonnell123@gmail.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;18048942216</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/assets/images/inverted-logo.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/assets/images/hugo-logo-wide.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/assets/js/jquery-3.4.1.min.js"></script>
<script src="/assets/js/popper.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>

<script src="/assets/js/navbar.js"></script>
<script src="/assets/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/assets/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
